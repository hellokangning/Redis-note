压缩列表（ziplist）是列表键和哈希键的底层实现之一。当一个列表键只包含少量列表现，并且每个列表项要么就是小整数值，要么就是长度较短的字符串，那么Redis就会使用压缩列表来实现列表键。

当一个哈希键只包含少量键值对，并且每个键值对要么是小整数值，要么是长度较短的字符串，Redis就会使用压缩列表来实现哈希键。

# 7.1 压缩列表的构成

压缩列表是Redis为了节约内存而开发的，由一系列特殊编码的连续内存块组成的顺序型（sequential）数据结构。一个压缩列表可以包含多个节点（entry），每个节点可以保存一个字节数组或者一个整数值。

压缩列表的各组成部分：

> zlbytes | zltail | zllen | entry1 | entry2 | … | entryN | zlend  

其中，

| 属性      | 类型        | 长度   | 用途                                       |
| ------- | --------- | ---- | ---------------------------------------- |
| zlbytes | uint32\_t | 4字节  | 记录压缩列表占用的内存字节数：在内存重分配，或计算zlend的位置时使用     |
| zltail  | uint32\_t | 4字节  | 记录表尾结点距离起始地址的字节数：通过这个偏移量，程序可以直接确定表尾结点的地址 |
| zllen   | uint16\_t | 2字节  | 记录节点数量：但这个属性小于UINT16\_MAX（65535）时，这个属性的值就是节点的数量。如果等于UINT16\_MAX，节点的真实数量要遍历整个压缩列表才能得到 |
| entryX  | 列表节点      | 不定   | 各个节点，节点的长度由保存的内容决定                       |
| zlend   | uint8\_t  | 1字节  | 特殊值0xFF，标记压缩列表的尾端                        |

# 7.2 压缩列表节点的构成

压缩列表的节点可以保存一个字节数组或者一个整数值。压缩节点的各个组成部分：

> previous_entry_length | encoding | content 

## previous_entry_length

previous_entry_length以字节为单位，记录前一个节点的长度。